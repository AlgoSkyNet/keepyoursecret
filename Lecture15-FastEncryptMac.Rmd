---
title: "Keep your secrets under control - Cryptography for All"
output:
  html_document: default
  html_notebook: default
  word_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

https://www.udemy.com/keep-your-secrets-under-control

#### Disclamer

By joining this course or using material from the course you agree that all materials of the course are solely provided "as is" without any guarantee of functionality. All methods are provided for training purposes. Course developed by non security expert by explaining the practical use of **OpenSSL** software library in `R Statistical Software`. There is a risk that you can loose your information in case you are not properly follow the instructions or by loosing your private key or alike. Make sure you know what you do at any time when using the material of the course. Always test your knowledge on dummy data before applying it to real data... Memory areas for your private key, secrets, or passphrase are not securely cleaned after use. You are using the material of the course at your own risk!

#### Lecture 15 Fast Encryp and Decrypt on Mac with 'bash' scripts

Hello and welcome back to one another lecture about practical use of Public Key Cryptography! This lecture is dedicated for Mac users. If you only use Windows you may simply skip it.

Our goal will be to re-create the concept of usage executable files like we did on Windows machine but now on Mac. Just a side note, Mac OS already uses OpenSSL library but we will want to use it via R Statistical Software.

What I would do now is to create a folder on my Desktop in Mac. This folder will be named '00_RSA'. This folder will contain my passwords, R scripts and executable files. Like in the previous lecture we can encrypt and decrypt our passwords within seconds.

Same idea: fit in the usb key containing Private Key, press one button and get our passwords decrypted. We can then open the file with passwords, check it, close it. Once done we can encrypt our file back by pressing the script Encrypt.sh

This lecture will be about to know how to execute our R scripts from Mac 

On Mac executable files are also named 'shell' scripts. It is a kind of a way to get more direct assess to the Operating System and programs installed on it. To try it out you can open 'Terminal' on your Mac. You can practice to execute some code there.

For example, to find out where our Rscript program is installed you can execute

```{bash}
which Rscript
```

in my case, the path of our Rscript program is: **/usr/local/bin/Rscript**

This is by the way exactly what we need. We can simply write in our Terminal this path and provide as an argument the name of our R script

Next, I will insert my USB key with a **Private.key**. I will then need to find the path of my **private.key**. It's a bit of a cumbersome in Mac. One way to find it is to go to the **Disk Utility** program and click on Info. You will be able to find the address of that USB Disk. It is **/Volumes/PRIVATE**. We will then need to use this address in our R Script. Another way, also a bit cumbersome is to select file or folder, hit **CMD+i**. This way we have a get info window. Select the path near **where** and press **CMD+c**. Then you can paste this to the R Script...

Have a look to the scripts EncryptM.R and DecryptM.R. You will find that I have defined paths to the private, public keys, passwords in clear text and encrypted form. The rest of code is exact same as in the previous lecture about doing so on Windows




After that all you need is to write a private and public keys there. The code to do this is available for you in the script `keys.R` that you can find in the branch CaseStudy-USB-Key:

```{r, eval=FALSE, include=TRUE}
# Used Libraries:
library(openssl)
library(tidyverse)

#### KEY MANAGEMENT ####
# save that to USB Key (Windows)
pathPrvKeyUSB <- file.path("D:/private.key")
pathPubKeyUSB <- file.path("D:/public.key")
# generate your private key (NB: make sure to do back up copy!!!)
rsa_keygen(bits = 2099) %>% 
  write_pem(path = pathPrvKeyUSB, password = "simple")
# generate your public key (NB: optional. Use Private Key to encrypt/decrypt)
read_key(file = pathPrvKeyUSB, password = "simple") %>% 
  # extract element of the list and write to file
  `[[`("pubkey") %>% write_pem(pathPubKeyUSB)

```

You should of course customize the code the way you want it... Remember to only run this code once!!!

Finally after you have run your code make sure to make keys backups. I would recommend you to use another USB key and store it in the physically safe place. Of course private key can also be stored under control of the Computer File System. It's totally fine to keep your backup there.

Just to conclude, this lecture was a bit simple to explain how to format your USB keys to be compatible for both windows and Mac. You now even have a code to write your private and public keys there.

To be honest this lecture is just a preparation for the next one where we will have a look how to use private and public keys to quickly encrypt and decrypt your passwords in very userfriendly way!!! I am looking forward to see your there!!!


