---
title: "Cryptorgraphy is more fun with R - Learn and use Public Key Cryptography with R Statistical Software"
output:
  html_document: default
  html_notebook: default
  word_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

https://www.udemy.com/keep-your-secrets-under-control

#### Disclamer

By joining this course or using material from the course you agree that all materials of the course are solely provided "as is" without any guarantee of functionality. All methods are provided for training purposes. Course developed by non security expert by explaining the practical use of **OpenSSL** software library in `R Statistical Software`. There is a risk that you can loose your information in case you are not properly follow the instructions or by loosing your private key or alike. Make sure you know what you do at any time when using the material of the course. Always test your knowledge on dummy data before applying it to real data... Memory areas for your private key, secrets, or passphrase are not securely cleaned after use. You are using the material of the course at your own risk!

#### Lecture 19 Advanced: Measure Encryption Speed

Hello and welcome back to the course. 

This lecture is optional and it is intended to have fun doing some research in *R*

#### How long will it take?

This will be an experiment to understanding how long will it take to encrypt information if we change two variables:

* if we use larger dataset
* if we use longer ke

#### Inputs

A. I will use csv dataset containing many rows, namely 

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
# import
ConsumerComplaints <- read_csv("ConsumerComplaints.csv")
# view dimensions
dim(ConsumerComplaints)
```

I will use this dataset to create 2 smaller ones 1/2 size and 1/4 size

```{r}
# create smaller datasets
ConsumerComplaints_half <- ConsumerComplaints[1:32749, ]
ConsumerComplaints_quart <- ConsumerComplaints[1:16374, ]
```

B. I will generate 3 keys of different sizes 

```{r}
library(openssl)
# minimum possible
key_1 <- rsa_keygen(bits = 512)

# standard size
key_2 <- rsa_keygen(bits = 2048)

# bigger key
key_3 <- rsa_keygen(bits = 4069)
```

#### Functions for benchmarking

Next, I will generate functio that will encrypt my information, write it to the file and decrypt it back

```{r}
Encrypt_Decrypt <- function(x, key){
  
  ## Encrypt with PRIVATE key (e.g. use this code yourself)
  x %>% 
  # serialize the object
  serialize(connection = NULL) %>% 
  # encrypt the object
  encrypt_envelope(key) %>% 
  # write encrypted data to File
  write_rds("data.raw")

  #### DECRYPT ####
  # read file with Encrypted Information (from Computer File System to R Environment)
  secret_encrypted <- read_rds("data.raw")

  # decrypting the list from R Environment
  res <- decrypt_envelope(data = secret_encrypted$data,
                   iv = secret_encrypted$iv,
                   session = secret_encrypted$session,
                   key = key,
                   password = "") %>% 
    # getting back original object in a form of the data frame
  unserialize() 
  # return result
  return(res)
}

```


#### Benchmarking experiment

I will be using library 'benchmarkme' in order to perform simulations several times and record results to the dataframe. Perhaps I will keep this overnight...?

```{r, message=FALSE, warning=FALSE}
#install.packages("benchmarkme")
library(benchmarkme)
```

#### My system

To make things fair let me just show you my system, nothing in particular:)

```{r}
get_ram()
```


```{r}
get_cpu()
```

In this case only CPU speed is important as R is just using 1 core.

But I can test my system to see where I am respect others:

```{r}
# Run the io benchmark (read and write file 5MB)
res <- benchmark_io(runs = 1, size = 5)
```

```{r}
res
```

#### Benchmarking experiment

```{r}
#install.packages("microbenchmark")
library(microbenchmark)
```

Let's run our experiment! By default each configuration will run 100 times so we will have 900 registrations to do... It might take a while:)

```{r, eval=FALSE, include=TRUE}
# running the experiment 100 times each!
experiment <- microbenchmark(sol1 = Encrypt_Decrypt(ConsumerComplaints_quart, key_1),
                             sol2 = Encrypt_Decrypt(ConsumerComplaints_half, key_1),
                             sol3 = Encrypt_Decrypt(ConsumerComplaints, key_1),
                             sol4 = Encrypt_Decrypt(ConsumerComplaints_quart, key_2),
                             sol5 = Encrypt_Decrypt(ConsumerComplaints_half, key_2),
                             sol6 = Encrypt_Decrypt(ConsumerComplaints, key_2),
                             sol7 = Encrypt_Decrypt(ConsumerComplaints_quart, key_3),
                             sol8 = Encrypt_Decrypt(ConsumerComplaints_half, key_3),
                             sol9 = Encrypt_Decrypt(ConsumerComplaints, key_3),
                             times = 100
                            )
write_rds(experiment, "experiment.rds") 
```

```{r}
# see the plot
experiment <- read_rds("experiment.rds") 
plot(experiment, xlab = "Configuration ID", ylab = "Time in nanoseconds")
```



```{r}
# the longest solution:
microbenchmark(so = Encrypt_Decrypt(ConsumerComplaints, key_3))
```

#### Results

Time to encrypt and decrypt does not seem to be related to the size of the key but it is related on the size of the dataset
It is roughly need 1/2 second to encrypt, write the file, read the file and decrypt information

Enough research! Thanks for reading! 



