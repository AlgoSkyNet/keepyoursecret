---
title: "Keep your secrets under control - Cryptography for All"
output:
  html_document: default
  html_notebook: default
  word_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

https://www.udemy.com/keep-your-secrets-under-control

#### Disclamer

By joining this course or using material from the course you agree that all materials of the course are solely provided "as is" without any guarantee of functionality. All methods are provided for training purposes. Course developed by non security expert by explaining the practical use of **OpenSSL** software library in `R Statistical Software`. There is a risk that you can loose your information in case you are not properly follow the instructions or by loosing your private key or alike. Make sure you know what you do at any time when using the material of the course. Always test your knowledge on dummy data before applying it to real data... Memory areas for your private key, secrets, or passphrase are not securely cleaned after use. You are using the material of the course at your own risk!

#### Lecture 12 How to send Secret

Hello and welcome back! In this case study we will look on how to securely **exchange** information. We will look how to exchange user credentials.

In order to reduce confusion I will bring back this slide. This slide was already discussed in the lecture number 4. Here you see in green information sender, for example yourself. Your partner with both keys will be called here information receiver.

You can see now how the entire flow will be among parties. 

* First you send the R Script 'Receiver.R' to your Colleague
* Your colleague will generate a key pair
* Your colleague will send you a Public Key
* You will Encrypt information with a script 'Sender.R'
* You can now securely send Encrypted information
* and your colleague may now decrypt user credentials using own Private Key

I have included both R Scripts to the lecture feel free to practice on dummy data! 

For reverse process you can just exchange R scripts! That is all!

##### R Script 'Receiver.R'

```{r, eval=FALSE, include=TRUE}
# Used Libraries:
library(openssl)
library(tidyverse)

# Scenario: Information Reciever!!!

# Instructions:
# A. Generate Private and Public Keys
# B. Send your Public Key to info Sender
# C. Once recieved - decrypt information

#### KEY MANAGEMENT ####
# generate your private key (NB: make sure to do back up copy!!!)
rsa_keygen(bits = 2099) %>% 
  write_pem(path = "private.key", password = "simple")
# generate your public key (NB: optional. Use Private Key to encrypt/decrypt)
read_key(file = "private.key", password = "simple") %>% 
  # extract element of the list and write to file
  `[[`("pubkey") %>% write_pem("public.key")


#### DECRYPT ####
# read file with Encrypted Information (from Computer File System to R Environment)
secret_encrypted <- read_rds("password.Encrypted")

# decrypting the list from R Environment
decrypt_envelope(data = secret_encrypted$data,
                 iv = secret_encrypted$iv,
                 session = secret_encrypted$session,
                 key = "private.key",
                 password = "simple") %>% 
  # getting back original object in a form of the data frame
  unserialize() 

# remove secret_encrypted object
rm(secret_encrypted)

```


##### R Script 'Sender.R'

```{r, eval=FALSE, include=TRUE}
# Used Libraries:
library(openssl)
library(tidyverse)

# Scenario: Information Sender!!!

# Instructions:
# A. Get Public Key
# B. Encrypt Password
# C. Send 'password.Encrypted'

#### ENCRYPT ####
# You can encrypt both using private or public key
# NB: Make sure you have valid copy of Private Key matching your Public Key

## WHAT YOU WANT TO ENCRYPT???
secret <- "Pass-Word-1234"

  secret %>% 
    # serialize the object
    serialize(connection = NULL) %>% 
    # encrypt the object
    encrypt_envelope("public.key") %>% 
    # write encrypted data to File
    write_rds("password.Encrypted") 
  
## remove secret
remove(list = ls())

## clean console and history...
```

