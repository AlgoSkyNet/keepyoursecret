---
title: "Keep your secrets under control - Cryptography for All"
output:
  html_document: default
  html_notebook: default
  word_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

https://www.udemy.com/keep-your-secrets-under-control

#### Disclamer

By joining this course or using material from the course you agree that all materials of the course are solely provided "as is" without any guarantee of functionality. All methods are provided for training purposes. Course developed by non security expert by explaining the practical use of **OpenSSL** software library in `R Statistical Software`. There is a risk that you can loose your information in case you are not properly follow the instructions or by loosing your private key or alike. Make sure you know what you do at any time when using the material of the course. Always test your knowledge on dummy data before applying it to real data... Memory areas for your private key, secrets, or passphrase are not securely cleaned after use. You are using the material of the course at your own risk!

#### Lecture 17 Keep your encrypted secret in Google Drive

Hello and welcome back to the course Keep Your secret under your control. Keeping secrets is difficult. You need to consider not only to keep this secret securely encrypted. You may need to make sure that secret is updated, and synronized among different computers. At home, at work, etc

In this lecture I would like to cover the idea of connecting R to google drive. Simply say reading and writing information from R to google drive and back... our information will be encrypted and should be assessible from multiple devices that have google drive access rights

Let's run our core code from previous lectures to generate the secret in the encrypted form and store that to the file...

```{r}
# Used Libraries:
library(openssl)
library(tidyverse)

#### ENCRYPT ####
pathPrvKeyUSB <- file.path("/Volumes/PRIVATE/private.key")
pathPubKeyUSB <- file.path("/Volumes/PRIVATE/public.key")
pathPasswFILE <- file.path("passwords.csv")
pathEncryFILE <- file.path("password.Encrypted")

## Encrypting the secret and storing that to file "password.Encrypted"
if(identical(read_pubkey(pathPubKeyUSB)$fingerprint,
             read_key(pathPrvKeyUSB, password = "simple")$pubkey$fingerprint)) {
  read_csv(pathPasswFILE) %>% 
    # serialize the object
    serialize(connection = NULL) %>% 
    # encrypt the object
    encrypt_envelope(pathPubKeyUSB) %>% 
    # write encrypted data to File
    write_rds(pathEncryFILE) } else { print("You are attempting to encrypt without having proper copy of Private Key")}

## clean non encrypted file if encrypted file does exist and history...
if(file.exists(pathEncryFILE)) {file.remove(pathPasswFILE)}

## remove variables
remove(list = ls())

```

At this moment of time we have our file named `password.Encrypted` in the R Project file

My idea will be to bring this file to the google drive and keep there!

#### http://googledrive.tidyverse.org

next instructions will be taken from above site of **tidyverse** development team

```{r, message=FALSE, warning=FALSE}
# installing and loading package
#install.packages("googledrive")
library(googledrive)
```

##### Assessing the package

```{r}
drive_find(n_max = 10)
```

After authentification we will be able to access files in google drive

```{r}
# uploads file to google drive
drive_upload("password.Encrypted", verbose = FALSE)
```

That is it, file in the Drive!!!

##### check if the file is in the drive and delete local file [optional]

I would like to delete local file but first checking if our 

```{r}
# check that file is in the drive
isExist <- drive_find("password.Encrypted", verbose = FALSE)

# delete file locally after checking that file is in the drive
if(nrow(isExist) > 0){
  file.remove("password.Encrypted")
}

```


##### retrieving the file and removing it from the google drive [optional]

```{r}
# retrieve the encrypted file and placing that locally
drive_download("password.Encrypted", verbose = TRUE)

# check if the file was downloaded
if(file.exists("password.Encrypted")){
  # remove file from drive
  drive_rm("password.Encrypted")
}

```

##### Decrypting files

```{r}
# decrypting file and deleting it...

#### DECRYPT ####
# path to keys on USB Stick
pathPrvKeyUSB <- file.path("/Volumes/PRIVATE/private.key")
pathPubKeyUSB <- file.path("/Volumes/PRIVATE/public.key")
pathPasswFILE <- file.path("passwords.csv")
pathEncryFILE <- file.path("password.Encrypted")

# read file with Encrypted Information (from Computer File System to R Environment)
secret_encrypted <- read_rds(pathEncryFILE)

# decrypting the list from R Environment
decrypt_envelope(data = secret_encrypted$data,
                 iv = secret_encrypted$iv,
                 session = secret_encrypted$session,
                 key = pathPrvKeyUSB,
                 password = "simple") %>% 
  # getting back original object in a form of the data frame
  unserialize() %>% 
  # writing file back
  write_csv(pathPasswFILE)

# remove encrypted object
if(file.exists(pathPasswFILE)) {file.remove(pathEncryFILE)}

# remove secret_encrypted object
remove(list = ls())

```

#### conclusion

R provides very easy interface to google drive. It is very easy to store files, retrieve them, update them and so on!

This is how we can keep our secrets more secured against loss of information!

That's basically it! I hope you enjoyed that!!!